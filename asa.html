<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Bütünleşik Ambar Arayüzü</title>
    <style>
        /* ====================================
           1. CSS STİLLERİ
           ==================================== */

        /* Temel Sayfa Ayarları */
        body {
            margin: 0;
            font-family: Tahoma, sans-serif;
            background-color: #008080;
            /* Klasik Windows masaüstü rengi */
            overflow: hidden;
            user-select: none;
            /* Metin seçimini engelle */
        }

        /* Pencere Stili */
        .window {
            position: absolute;
            border: 1px solid #000;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            background-color: #f0f0f0;
            min-width: 250px;
            min-height: 150px;
            overflow: hidden;
            z-index: 10;
        }

        /* Başlık Çubuğu Stili (Sürükleme Alanı) */
        .title-bar {
            background-color: #000080;
            color: white;
            padding: 3px 5px;
            cursor: grab;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title-text {
            font-weight: bold;
            flex-grow: 1;
        }

        .window-controls button {
            background-color: #c0c0c0;
            border: 1px solid #000;
            margin-left: 2px;
            cursor: pointer;
            font-size: 10px;
            width: 20px;
            height: 20px;
            line-height: 1;
            padding: 0;
            font-weight: bold;
        }

        .content {
            padding: 10px;
            max-height: calc(100% - 30px);
            /* Başlık çubuğundan sonraki alan */
            overflow: auto;
        }

        /* Tablo Stili */
        #invoice-table {
            width: 100%;
            border-collapse: collapse;
        }

        #invoice-table th,
        #invoice-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        #invoice-table button {
            cursor: pointer;
            padding: 3px 6px;
        }

        /* Yeniden Boyutlandırma Köşesi Stili */
        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            cursor: nwse-resize;
            background-color: transparent;
            z-index: 1;
            /* Pencerenin içeriği altında kalmasın */
        }

        /* Görev Çubuğu Stili */
        #taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 35px;
            background-color: #c0c0c0;
            border-top: 1px solid #ffffff;
            z-index: 1000;
            padding: 3px;
            display: flex;
        }

        #taskbar-items {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }

        .taskbar-item {
            background-color: #c0c0c0;
            border: 1px outset #fff;
            padding: 2px 10px;
            margin-right: 5px;
            cursor: pointer;
            line-height: 25px;
            font-size: 14px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            /* Yan yana dizilmeyi sağlar */
            min-width: 150px;
            max-width: 200px;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .taskbar-item.active {
            border: 1px inset #000;
            background-color: #e0e0e0;
        }

        /* Kapatma İkonu (Görev Çubuğu Üzerinde) */
        .taskbar-item .close-icon {
            position: absolute;
            right: 0;
            top: 0;
            width: 20px;
            height: 100%;
            background-color: transparent;
            color: #333;
            font-weight: bold;
            display: none;
            cursor: pointer;
            text-align: center;
            line-height: 30px;
            z-index: 10;
        }

        /* Hover efekti */
        .taskbar-item:hover .close-icon {
            display: block;
            background-color: #ff6666;
            color: white;
        }

        /* Bağlam Menüsü Stili */
        #context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 2000;
            display: none;
        }

        #context-menu li {
            padding: 5px 15px;
            cursor: pointer;
        }

        #context-menu li:hover {
            background-color: #0078d7;
            color: white;
        }
    </style>
</head>

<body>

    <div class="window" id="main-window" style="top: 50px; left: 50px; width: 600px; height: 350px;">
        <div class="title-bar">
            <span class="title-text">Ana Yönetim Paneli</span>
            <div class="window-controls">
                <button class="minimize-btn" onclick="minimize('main-window')">-</button>
                <button class="close-btn" onclick="closeWindow('main-window')">X</button>
            </div>
        </div>
        <div class="content">
            <h2>Qaimə Siyahısı (Fatura Listesi)</h2>
            <table id="invoice-table">
                <thead>
                    <tr>
                        <th>Qaimə №</th>
                        <th>Tarix</th>
                        <th>Məbləğ</th>
                        <th>Əməliyyat</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-id="1001" data-title="Qaimə #1001" data-date="01.05.2025" data-amount="450 AZN">
                        <td>1001</td>
                        <td>01.05.2025</td>
                        <td>450 AZN</td>
                        <td><button onclick="openInvoice('1001')">Aç</button></td>
                    </tr>
                    <tr data-id="1002" data-title="Qaimə #1002" data-date="05.05.2025" data-amount="1200 AZN">
                        <td>1002</td>
                        <td>05.05.2025</td>
                        <td>1200 AZN</td>
                        <td><button onclick="openInvoice('1002')">Aç</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="resize-handle"></div>
    </div>

    <div id="taskbar">
        <div id="taskbar-items"></div>
    </div>

    <template id="invoice-template">
        <div class="window invoice-window" style="width: 500px; height: 300px;">
            <div class="title-bar">
                <span class="title-text"></span>
                <div class="window-controls">
                    <button class="minimize-btn" onclick="minimize(this.closest('.window').id)">-</button>
                    <button class="close-btn" onclick="closeWindow(this.closest('.window').id)">X</button>
                </div>
            </div>
            <div class="content">
                <h4>Fatura Detayları:</h4>
                <p>Nömrə: <span class="invoice-number"></span></p>
                <p>Tarix: <span class="invoice-date"></span></p>
                <p>Məbləğ: <span class="invoice-amount"></span></p>
                <textarea
                    style="width: 95%; height: 80px; resize: none; margin-top: 10px;">Mal/Hizmet detayları ve notlar...</textarea>
            </div>
            <div class="resize-handle"></div>
        </div>
    </template>

    <ul id="context-menu" data-target-id="">
        <li data-action="focus">Aç / Odaklan</li>
        <li data-action="minimize">Küçült</li>
        <li data-action="close">Kapat</li>
    </ul>

    <script>
        // ====================================
        // 2. JAVASCRIPT İŞLEVLERİ
        // ====================================

        let zIndexCounter = 10;
        const taskbarItemsContainer = document.getElementById('taskbar-items');
        const contextMenu = document.getElementById('context-menu');
        const openedWindows = new Set(); // Açık pencerelerin ID'lerini tutar

        // --- Yardımcı İşlevler ---

        function focusWindow(windowId) {
            const windowEl = document.getElementById(windowId);
            if (!windowEl) return;

            zIndexCounter++;
            windowEl.style.zIndex = zIndexCounter;
            windowEl.style.display = 'block'; // Odaklanırken görünür yap

            document.querySelectorAll('.taskbar-item').forEach(item => item.classList.remove('active'));
            const taskbarItem = document.querySelector(`.taskbar-item[data-id="${windowId}"]`);
            if (taskbarItem) {
                taskbarItem.classList.add('active');
            }
        }

        function minimize(windowId) {
            const windowEl = document.getElementById(windowId);
            if (windowEl) windowEl.style.display = 'none';

            const taskbarItem = document.querySelector(`.taskbar-item[data-id="${windowId}"]`);
            if (taskbarItem) taskbarItem.classList.remove('active');
        }

        function closeWindow(windowId) {
            const windowEl = document.getElementById(windowId);
            if (windowEl) {
                windowEl.remove();
                openedWindows.delete(windowId);
            }
            const taskbarItem = document.querySelector(`.taskbar-item[data-id="${windowId}"]`);
            if (taskbarItem) taskbarItem.remove();

            // Kapatılan pencere görev çubuğunda seçiliyse, diğer bir pencereye odaklan
            const remainingWindows = Array.from(document.querySelectorAll('.window'));
            if (remainingWindows.length > 0) {
                focusWindow(remainingWindows[remainingWindows.length - 1].id);
            }
        }

        // --- Pencere Yöneticisi İşlevleri ---

        function openInvoice(invoiceId) {
            // Her açışta benzersiz ID oluşturmak için timestamp kullan (Çoklu pencereye izin verir)
            const uniqueWindowId = `invoice-${invoiceId}-${Date.now()}`;

            const row = document.querySelector(`#invoice-table tr[data-id="${invoiceId}"]`);
            if (!row) return;

            const invoiceNumber = row.cells[0].textContent;
            const invoiceDate = row.cells[1].textContent;
            const invoiceAmount = row.cells[2].textContent;
            const invoiceTitle = `Qaimə #${invoiceNumber}`;

            const template = document.getElementById('invoice-template');
            const newWindow = template.content.firstElementChild.cloneNode(true);

            newWindow.id = uniqueWindowId;
            // Pencereleri kademeli olarak aç
            const offset = (openedWindows.size * 20) % 150;
            newWindow.style.top = `${100 + offset}px`;
            newWindow.style.left = `${100 + offset}px`;

            newWindow.querySelector('.title-text').textContent = invoiceTitle;
            newWindow.querySelector('.invoice-number').textContent = invoiceNumber;
            newWindow.querySelector('.invoice-date').textContent = invoiceDate;
            newWindow.querySelector('.invoice-amount').textContent = invoiceAmount;

            document.body.appendChild(newWindow);
            openedWindows.add(uniqueWindowId);

            makeDraggable(newWindow);
            makeResizable(newWindow);
            newWindow.addEventListener('mousedown', () => focusWindow(uniqueWindowId));

            createTaskbarItem(uniqueWindowId, invoiceTitle);
            focusWindow(uniqueWindowId);
        }

        function makeDraggable(element) {
            const titleBar = element.querySelector('.title-bar');
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            titleBar.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                // Eğer kapatma/küçültme düğmesine tıklandıysa sürüklemeyi başlatma
                if (e.target.tagName === 'BUTTON') return;

                e.preventDefault();
                focusWindow(element.id);

                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();

                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;

                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        function makeResizable(element) {
            const resizeHandle = element.querySelector('.resize-handle');
            if (!resizeHandle) return; // Ana pencere için resize-handle HTML'de olmalı

            let startX, startY, startWidth, startHeight;

            resizeHandle.onmousedown = initResize;

            function initResize(e) {
                e.preventDefault();
                e.stopPropagation();
                focusWindow(element.id);

                startX = e.clientX;
                startY = e.clientY;
                startWidth = parseInt(document.defaultView.getComputedStyle(element).width, 10);
                startHeight = parseInt(document.defaultView.getComputedStyle(element).height, 10);

                document.onmousemove = doResize;
                document.onmouseup = stopResize;
            }

            function doResize(e) {
                const newWidth = startWidth + e.clientX - startX;
                const newHeight = startHeight + e.clientY - startY;

                // Minimum boyut kontrolü (CSS'deki min-width/height ile uyumlu olmalı)
                if (newWidth > 250) {
                    element.style.width = newWidth + 'px';
                }
                if (newHeight > 150) {
                    element.style.height = newHeight + 'px';
                }
            }

            function stopResize() {
                document.onmousemove = null;
                document.onmouseup = null;
            }
        }

        // --- Görev Çubuğu ve Menü İşlevleri ---

        function createTaskbarItem(windowId, title) {
            const item = document.createElement('div');
            item.className = 'taskbar-item';

            // Başlık metni
            item.textContent = title;
            item.setAttribute('data-id', windowId);

            // Kapatma İkonu (Hover ile görünecek)
            const closeIcon = document.createElement('span');
            closeIcon.className = 'close-icon';
            closeIcon.textContent = 'X';
            item.appendChild(closeIcon);

            // Tıklama Olayı (Aç/Küçült)
            item.addEventListener('click', (e) => {
                // Eğer 'X' ikonuna tıklandıysa, kapatma işlemini yap
                if (e.target.className === 'close-icon') {
                    closeWindow(windowId);
                    return;
                }

                const windowEl = document.getElementById(windowId);
                if (windowEl.style.display === 'block') {
                    minimize(windowId);
                } else {
                    focusWindow(windowId);
                }
            });

            // Sağ Tık Olayı (Context Menu)
            item.addEventListener('contextmenu', (e) => {
                e.preventDefault();

                contextMenu.style.left = `${e.clientX}px`;
                contextMenu.style.top = `${e.clientY}px`;
                contextMenu.style.display = 'block';
                contextMenu.setAttribute('data-target-id', windowId);
            });

            taskbarItemsContainer.appendChild(item);
        }

        // Sağ Tık Menüsü İşlemlerini Yönetme
        contextMenu.addEventListener('click', (e) => {
            const targetId = contextMenu.getAttribute('data-target-id');
            const action = e.target.getAttribute('data-action');

            if (targetId && action) {
                switch (action) {
                    case 'focus':
                        focusWindow(targetId);
                        break;
                    case 'minimize':
                        minimize(targetId);
                        break;
                    case 'close':
                        closeWindow(targetId);
                        break;
                }
            }
            contextMenu.style.display = 'none';
        });

        // Sayfanın herhangi bir yerine tıklanınca menüyü kapatma
        document.addEventListener('click', () => {
            contextMenu.style.display = 'none';
        });
        document.addEventListener('contextmenu', (e) => {
            // Görev çubuğu öğesi değilse menüyü kapat
            if (!e.target.closest('.taskbar-item')) {
                contextMenu.style.display = 'none';
            }
        });


        // --- Başlangıç Ayarları ---

        document.addEventListener('DOMContentLoaded', () => {
            const mainWindow = document.getElementById('main-window');
            if (mainWindow) {
                makeDraggable(mainWindow);
                makeResizable(mainWindow);
                mainWindow.addEventListener('mousedown', () => focusWindow('main-window'));
                createTaskbarItem('main-window', mainWindow.querySelector('.title-bar .title-text').textContent);
                focusWindow('main-window');
            }
        });
    </script>
</body>

</html>